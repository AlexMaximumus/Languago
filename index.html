<!DOCTYPE html>
<html>
<head>
    <title>Êó•Êú¨Ë™û Study</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#e74c3c">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
        /* ... existing styles ... */

        /* –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è emoji-section */
        #emoji-section {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <button class="back-button" onclick="showMainMenu()">‚Üê –ù–∞–∑–∞–¥</button>
        
        <div class="header">
            <h1>Êó•Êú¨Ë™û Study</h1>
            <p>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º –∏–∑—É—á–µ–Ω–∏—è</p>
        </div>

        <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
        <div id="main-menu" class="main-menu">
            <div class="main-menu-item" onclick="showSection('words')">
                <div class="main-menu-icon">üìö</div>
                <div class="main-menu-title">–ò–∑—É—á–µ–Ω–∏–µ —Å–ª–æ–≤</div>
                <div class="main-menu-description">–Ø–ø–æ–Ω—Å–∫–∏–µ —Å–ª–æ–≤–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</div>
            </div>
            <div class="main-menu-item" onclick="showSection('kanji')">
                <div class="main-menu-icon">Êº¢</div>
                <div class="main-menu-title">–ò–∑—É—á–µ–Ω–∏–µ –∫–∞–Ω–¥–∑–∏</div>
                <div class="main-menu-description">–Ø–ø–æ–Ω—Å–∫–∏–µ –∏–µ—Ä–æ–≥–ª–∏—Ñ—ã</div>
            </div>
            <div class="main-menu-item" onclick="showSection('test')">
                <div class="main-menu-icon">‚úçÔ∏è</div>
                <div class="main-menu-title">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</div>
                <div class="main-menu-description">–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–Ω–∞–Ω–∏–π</div>
            </div>
            <div class="main-menu-item" onclick="showSection('emoji')">
                <div class="main-menu-icon">üòä</div>
                <div class="main-menu-title">–°–º–∞–π–ª–∏–∫–∏</div>
                <div class="main-menu-description">–ò–∑—É—á–µ–Ω–∏–µ —ç–º–æ–¥–∑–∏</div>
            </div>
        </div>

        <!-- –†–∞–∑–¥–µ–ª—ã -->
        <div id="words-section">
            <div id="categories-container" class="categories-grid"></div>
            <div id="flashcards-container"></div>
        </div>

        <div id="kanji-section">
            <p style="text-align: center; color: var(--tg-theme-hint-color);">
                –†–∞–∑–¥–µ–ª –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
            </p>
        </div>

        <div id="test-section">
            <p style="text-align: center; color: var(--tg-theme-hint-color);">
                –†–∞–∑–¥–µ–ª –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
            </p>
        </div>

        <div id="emoji-section">
            <div id="emoji-categories-container" class="categories-grid"></div>
            <div id="emoji-flashcards-container"></div>
        </div>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();

        // –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let categories = null;
        let currentCategory = null;
        let currentCardIndex = 0;
        let currentSection = 'main';

        // –ù–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —ç–º–æ–¥–∑–∏
        let emojiCategories = null;
        let currentEmojiCategory = null;
        let currentEmojiCardIndex = 0;

        // –ü–æ–∫–∞–∑–∞—Ç—å –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
        function showMainMenu() {
            document.querySelector('.back-button').style.display = 'none';
            document.querySelector('.header p').textContent = '–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º –∏–∑—É—á–µ–Ω–∏—è';
            document.getElementById('main-menu').style.display = 'grid';
            document.getElementById('words-section').style.display = 'none';
            document.getElementById('kanji-section').style.display = 'none';
            document.getElementById('test-section').style.display = 'none';
            document.getElementById('emoji-section').style.display = 'none';
            
            if (currentSection === 'words') {
                document.getElementById('categories-container').style.display = 'grid';
                document.getElementById('flashcards-container').style.display = 'none';
            } else if (currentSection === 'emoji') {
                document.getElementById('emoji-categories-container').style.display = 'grid';
                document.getElementById('emoji-flashcards-container').style.display = 'none';
            }
            
            currentSection = 'main';
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ä–∞–∑–¥–µ–ª
        function showSection(section) {
            document.querySelector('.back-button').style.display = 'block';
            document.getElementById('main-menu').style.display = 'none';
            
            document.getElementById('words-section').style.display = 'none';
            document.getElementById('kanji-section').style.display = 'none';
            document.getElementById('test-section').style.display = 'none';
            document.getElementById('emoji-section').style.display = 'none';
            
            let title = '';
            switch(section) {
                case 'words': 
                    title = '–ò–∑—É—á–µ–Ω–∏–µ —Å–ª–æ–≤';
                    loadCategories();
                    document.getElementById('words-section').style.display = 'block';
                    document.getElementById('categories-container').style.display = 'grid';
                    break;
                case 'kanji': 
                    title = '–ò–∑—É—á–µ–Ω–∏–µ –∫–∞–Ω–¥–∑–∏'; 
                    document.getElementById('kanji-section').style.display = 'block';
                    break;
                case 'test': 
                    title = '–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ'; 
                    document.getElementById('test-section').style.display = 'block';
                    break;
                case 'emoji':
                    title = '–ò–∑—É—á–µ–Ω–∏–µ —Å–º–∞–π–ª–∏–∫–æ–≤';
                    loadEmojiCategories();
                    document.getElementById('emoji-section').style.display = 'block';
                    document.getElementById('emoji-categories-container').style.display = 'grid';
                    break;
            }
            document.querySelector('.header p').textContent = title;
            
            currentSection = section;
        }

        // –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
        // ... existing functions ...

        // –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ —Å–º–∞–π–ª–∏–∫–∞–º–∏
        async function loadEmojiCategories() {
            try {
                const response = await fetch('/Languago/emoji.json');
                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${response.status}`);
                }
                const data = await response.json();
                emojiCategories = data;
                displayEmojiCategories();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                document.getElementById('emoji-categories-container').innerHTML = `
                    <div style="text-align: center; color: var(--tg-theme-hint-color);">
                        <p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</p>
                        <button onclick="loadEmojiCategories()" class="nav-button">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</button>
                    </div>
                `;
            }
        }

        function displayEmojiCategories() {
            const container = document.getElementById('emoji-categories-container');
            container.innerHTML = '';
            container.style.display = 'grid';

            for (const [id, category] of Object.entries(emojiCategories)) {
                const categoryCard = document.createElement('div');
                categoryCard.className = 'category-card';
                categoryCard.onclick = () => showEmojiCategory(id);
                categoryCard.innerHTML = `
                    <div class="category-icon">${category.icon}</div>
                    <div class="category-title">${category.title}</div>
                    <div class="category-count">${category.emojis.length} —ç–º–æ–¥–∑–∏</div>
                `;
                container.appendChild(categoryCard);
            }
        }

        function showEmojiCategory(categoryId) {
            currentEmojiCategory = categoryId;
            currentEmojiCardIndex = 0;
            
            document.getElementById('emoji-categories-container').style.display = 'none';
            document.getElementById('emoji-flashcards-container').style.display = 'block';
            document.querySelector('.header p').textContent = `${emojiCategories[categoryId].title}`;
            
            updateEmojiCard();
        }

        function updateEmojiCard() {
            const category = emojiCategories[currentEmojiCategory];
            const card = category.emojis[currentEmojiCardIndex];
            
            const container = document.getElementById('emoji-flashcards-container');
            container.innerHTML = `
                <div class="flashcard" onclick="flipCard(this)">
                    <div class="flashcard-inner">
                        <div class="flashcard-front">
                            <div class="kanji" style="font-size: 96px;">${card.emoji}</div>
                        </div>
                        <div class="flashcard-back">
                            <div class="meaning">${card.name}</div>
                            <div class="romaji">${card.description}</div>
                        </div>
                    </div>
                </div>
                <div class="navigation">
                    <button class="nav-button" onclick="previousEmojiCard()">‚Üê –ù–∞–∑–∞–¥</button>
                    <button class="nav-button" onclick="nextEmojiCard()">–í–ø–µ—Ä—ë–¥ ‚Üí</button>
                </div>
                <div class="progress">
                    –ö–∞—Ä—Ç–æ—á–∫–∞ ${currentEmojiCardIndex + 1} –∏–∑ ${category.emojis.length}
                </div>
            `;
        }

        function nextEmojiCard() {
            const category = emojiCategories[currentEmojiCategory];
            currentEmojiCardIndex = (currentEmojiCardIndex + 1) % category.emojis.length;
            updateEmojiCard();
        }

        function previousEmojiCard() {
            const category = emojiCategories[currentEmojiCategory];
            currentEmojiCardIndex = (currentEmojiCardIndex - 1 + category.emojis.length) % category.emojis.length;
            updateEmojiCard();
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            tg.ready();
            showMainMenu();
        });
    </script>
</body>
</html>
